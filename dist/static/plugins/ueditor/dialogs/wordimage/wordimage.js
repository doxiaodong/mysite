function hideFlash(){flashObj=null,flashContainer.innerHTML=""}function addOkListener(){dialog.onok=function(){if(!imageUrls.length)return;var e=editor.getOpt("imageUrlPrefix"),t=domUtils.getElementsByTagName(editor.document,"img");editor.fireEvent("saveScene");for(var n=0,r;r=t[n++];){var i=r.getAttribute("word_img");if(!i)continue;for(var s=0,o;o=imageUrls[s++];)if(i.indexOf(o.original.replace(" ",""))!=-1){r.src=e+o.url,r.setAttribute("_src",e+o.url),r.setAttribute("title",o.title),domUtils.removeAttributes(r,["word_img","style","width","height"]),editor.fireEvent("selectionchange");break}}editor.fireEvent("saveScene"),hideFlash()},dialog.oncancel=function(){hideFlash()}}function addUploadListener(){g("upload").onclick=function(){flashObj.upload(),this.style.display="none"}}function showLocalPath(e){var t=editor.selection.getRange().getClosedNode(),n=editor.execCommand("wordimage");if(n.length==1||t&&t.tagName=="IMG"){g(e).value=n[0];return}var r=n[0],i=r.lastIndexOf("/")||0,s=r.lastIndexOf("\\")||0,o=i>s?"/":"\\";r=r.substring(0,r.lastIndexOf(o)+1),g(e).value=r}function createFlashUploader(e,t){var n=utils.extend({},lang.flashI18n);for(var r in n)!(r in{lang:1,uploadingTF:1,imageTF:1,textEncoding:1})&&n[r]&&(n[r]=encodeURIComponent(editor.options.langPath+editor.options.lang+"/images/"+n[r]));e=utils.extend(e,n,!1);var i={createOptions:{id:"flash",url:e.flashUrl,width:e.width,height:e.height,errorMessage:lang.flashError,wmode:browser.safari?"transparent":"window",ver:"10.0.0",vars:e,container:e.container}};i=extendProperty(t,i),flashObj=new baidu.flash.imageUploader(i),flashContainer=$G(e.container)}function extendProperty(e,t){for(var n in e)t[n]||(t[n]=e[n]);return t}function getPasteData(e){return baidu.g("msg").innerHTML=lang.copySuccess+"</br>",setTimeout(function(){baidu.g("msg").innerHTML=""},5e3),baidu.g(e).value}function createCopyButton(e,t){baidu.swf.create({id:"copyFlash",url:"fClipboard_ueditor.swf",width:"58",height:"25",errorMessage:"",bgColor:"#CBCBCB",wmode:"transparent",ver:"10.0.0",vars:{tid:t}},e);var n=baidu.swf.getMovie("copyFlash"),r=setInterval(function(){n&&n.flashInit&&(clearInterval(r),n.setHandCursor(!0),n.setContentFuncName("getPasteData"))},500)}var wordImage={},g=baidu.g,flashObj,flashContainer;wordImage.init=function(e,t){showLocalPath("localPath"),createFlashUploader(e,t),addUploadListener(),addOkListener()},createCopyButton("clipboard","localPath");