(function(){var e=$G("J_title"),t=$G("J_titleCol"),n=$G("J_caption"),r=$G("J_sorttable"),i=$G("J_autoSizeContent"),s=$G("J_autoSizePage"),o=$G("J_tone"),u,a=$G("J_preview"),f=function(){u=this,u.init()};f.prototype={init:function(){var a=new UE.ui.ColorPicker({editor:editor}),f=new UE.ui.Popup({editor:editor,content:a});e.checked=editor.queryCommandState("inserttitle")==-1,t.checked=editor.queryCommandState("inserttitlecol")==-1,n.checked=editor.queryCommandState("insertcaption")==-1,r.checked=editor.queryCommandState("enablesort")==1;var l=editor.queryCommandState("enablesort"),c=editor.queryCommandState("disablesort");r.checked=l<0&&c>=0,r.disabled=l<0&&c<0,r.title=l<0&&c<0?lang.errorMsg:"",u.createTable(e.checked,t.checked,n.checked),u.setAutoSize(),u.setColor(u.getColor()),domUtils.on(e,"click",u.titleHanler),domUtils.on(t,"click",u.titleColHanler),domUtils.on(n,"click",u.captionHanler),domUtils.on(r,"click",u.sorttableHanler),domUtils.on(i,"click",u.autoSizeContentHanler),domUtils.on(s,"click",u.autoSizePageHanler),domUtils.on(o,"click",function(){f.showAnchor(o)}),domUtils.on(document,"mousedown",function(){f.hide()}),a.addListener("pickcolor",function(){u.setColor(arguments[1]),f.hide()}),a.addListener("picknocolor",function(){u.setColor(""),f.hide()})},createTable:function(e,t,n){var r=[],i="<span>^</span>";r.push("<table id='J_example'>"),n&&r.push("<caption>"+lang.captionName+"</caption>");if(e){r.push("<tr>"),t&&r.push("<th>"+lang.titleName+"</th>");for(var s=0;s<5;s++)r.push("<th>"+lang.titleName+"</th>");r.push("</tr>")}for(var o=0;o<6;o++){r.push("<tr>"),t&&r.push("<th>"+lang.titleName+"</th>");for(var u=0;u<5;u++)r.push("<td>"+lang.cellsName+"</td>");r.push("</tr>")}r.push("</table>"),a.innerHTML=r.join(""),this.updateSortSpan()},titleHanler:function(){var t=$G("J_example"),n=document.createDocumentFragment(),r=domUtils.getComputedStyle(domUtils.getElementsByTagName(t,"td")[0],"border-color"),i=t.rows[0].children.length;if(e.checked){t.insertRow(0);for(var s=0,o;s<i;s++)o=document.createElement("th"),o.innerHTML=lang.titleName,n.appendChild(o);t.rows[0].appendChild(n)}else domUtils.remove(t.rows[0]);u.setColor(r),u.updateSortSpan()},titleColHanler:function(){var e=$G("J_example"),n=domUtils.getComputedStyle(domUtils.getElementsByTagName(e,"td")[0],"border-color"),r=e.rows,i=r.length;if(t.checked)for(var s=0,o;s<i;s++)o=document.createElement("th"),o.innerHTML=lang.titleName,r[s].insertBefore(o,r[s].children[0]);else for(var s=0;s<i;s++)domUtils.remove(r[s].children[0]);u.setColor(n),u.updateSortSpan()},captionHanler:function(){var e=$G("J_example");if(n.checked){var t=document.createElement("caption");t.innerHTML=lang.captionName,e.insertBefore(t,e.firstChild)}else domUtils.remove(domUtils.getElementsByTagName(e,"caption")[0])},sorttableHanler:function(){u.updateSortSpan()},autoSizeContentHanler:function(){var e=$G("J_example");e.removeAttribute("width")},autoSizePageHanler:function(){var e=$G("J_example"),t=e.getElementsByTagName(e,"td");utils.each(t,function(e){e.removeAttribute("width")}),e.setAttribute("width","100%")},updateSortSpan:function(){var e=$G("J_example"),t=e.rows[0],n=domUtils.getElementsByTagName(e,"span");utils.each(n,function(e){e.parentNode.removeChild(e)}),r.checked&&utils.each(t.cells,function(e,t){var n=document.createElement("span");n.innerHTML="^",e.appendChild(n)})},getColor:function(){var e=editor.selection.getStart(),t,n=domUtils.findParentByTagName(e,["td","th","caption"],!0);return t=n&&domUtils.getComputedStyle(n,"border-color"),t||(t="#DDDDDD"),t},setColor:function(e){var t=$G("J_example"),n=domUtils.getElementsByTagName(t,"td").concat(domUtils.getElementsByTagName(t,"th"),domUtils.getElementsByTagName(t,"caption"));o.value=e,utils.each(n,function(t){t.style.borderColor=e})},setAutoSize:function(){var e=this;s.checked=!0,e.autoSizePageHanler()}},new f,dialog.onok=function(){editor.__hasEnterExecCommand=!0;var e={title:"inserttitle deletetitle",titleCol:"inserttitlecol deletetitlecol",caption:"insertcaption deletecaption",sorttable:"enablesort disablesort"};editor.fireEvent("saveScene");for(var t in e){var n=e[t].split(" "),r=$G("J_"+t);r.checked?editor.queryCommandState(n[0])!=-1&&editor.execCommand(n[0]):editor.queryCommandState(n[1])!=-1&&editor.execCommand(n[1])}editor.execCommand("edittable",o.value),i.checked?editor.execCommand("adaptbytext"):"",s.checked?editor.execCommand("adaptbywindow"):"",editor.fireEvent("saveScene"),editor.__hasEnterExecCommand=!1}})();