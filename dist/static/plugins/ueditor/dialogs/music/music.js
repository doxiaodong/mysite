function Music(){this.init()}(function(){var e=[],t=[],n=null;Music.prototype={total:70,pageSize:10,dataUrl:"http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.search.common",playerUrl:"http://box.baidu.com/widget/flash/bdspacesong.swf",init:function(){var e=this;domUtils.on($G("J_searchName"),"keyup",function(t){var n=window.event||t;n.keyCode==13&&e.dosearch()}),domUtils.on($G("J_searchBtn"),"click",function(){e.dosearch()})},callback:function(e){var t=this;t.data=e.song_list,setTimeout(function(){$G("J_resultBar").innerHTML=t._renderTemplate(e.song_list)},300)},dosearch:function(){var e=this;n=null;var t=$G("J_searchName").value;if(utils.trim(t)=="")return!1;t=encodeURIComponent(t),e._sent(t)},doselect:function(e){var t=this;typeof e=="object"?n=e:typeof e=="number"&&(n=t.data[e])},onpageclick:function(n){var r=this;for(var i=0;i<e.length;i++)$G(e[i]).className="pageoff",$G(t[i]).className="paneloff";$G("page"+n).className="pageon",$G("panel"+n).className="panelon"},listenTest:function(e){var t=this,n=$G("J_preview"),r=e.className=="m-try",i=t._getTryingElem();i&&(i.className="m-try",n.innerHTML=""),r&&(e.className="m-trying",n.innerHTML=t._buildMusicHtml(t._getUrl(!0)))},_sent:function(e){var t=this;$G("J_resultBar").innerHTML='<div class="loading"></div>',utils.loadFile(document,{src:t.dataUrl+"&query="+e+"&page_size="+t.total+"&callback=music.callback&.r="+Math.random(),tag:"script",type:"text/javascript",defer:"defer"})},_removeHtml:function(e){var t=/<\s*\/?\s*[^>]*\s*>/gi;return e.replace(t,"")},_getUrl:function(e){var t=this,r="from=tiebasongwidget&url=&name="+encodeURIComponent(t._removeHtml(n.title))+"&artist="+encodeURIComponent(t._removeHtml(n.author))+"&extra="+encodeURIComponent(t._removeHtml(n.album_title))+"&autoPlay="+e+""+"&loop=true";return t.playerUrl+"?"+r},_getTryingElem:function(){var e=$G("J_listPanel").getElementsByTagName("span");for(var t=0;t<e.length;t++)if(e[t].className=="m-trying")return e[t];return null},_buildMusicHtml:function(e){var t='<embed class="BDE_try_Music" allowfullscreen="false" pluginspage="http://www.macromedia.com/go/getflashplayer"';return t+=' src="'+e+'"',t+=' width="1" height="1" style="position:absolute;left:-2000px;"',t+=' type="application/x-shockwave-flash" wmode="transparent" play="true" loop="false"',t+=' menu="false" allowscriptaccess="never" scale="noborder">',t},_byteLength:function(e){return e.replace(/[^\u0000-\u007f]/g,"aa").length},_getMaxText:function(e){var t=this;return e=t._removeHtml(e),t._byteLength(e)>12?e.substring(0,5)+"...":(e||(e="&nbsp;"),e)},_rebuildData:function(e){var t=this,n=[],r=t.pageSize,i;for(var s=0;s<e.length;s++)(s+r)%r==0&&(i=[],n.push(i)),i.push(e[s]);return n},_renderTemplate:function(n){var r=this;if(n.length==0)return'<div class="empty">'+lang.emptyTxt+"</div>";n=r._rebuildData(n);var i=[],s=[],o=[];i.push('<div id="J_listPanel" class="listPanel">'),s.push('<div class="page">');for(var u=0,a;a=n[u++];){t.push("panel"+u),e.push("page"+u),u==1?(i.push('<div id="panel'+u+'" class="panelon">'),n.length!=1&&o.push('<div id="page'+u+'" onclick="music.onpageclick('+u+')" class="pageon">'+u+"</div>")):(i.push('<div id="panel'+u+'" class="paneloff">'),o.push('<div id="page'+u+'" onclick="music.onpageclick('+u+')" class="pageoff">'+u+"</div>")),i.push('<div class="m-box">'),i.push('<div class="m-h"><span class="m-t">'+lang.chapter+'</span><span class="m-s">'+lang.singer+'</span><span class="m-z">'+lang.special+'</span><span class="m-try-t">'+lang.listenTest+"</span></div>");for(var f=0,l;l=a[f++];)i.push('<label for="radio-'+u+"-"+f+'" class="m-m">'),i.push('<input type="radio" id="radio-'+u+"-"+f+'" name="musicId" class="m-l" onclick="music.doselect('+(r.pageSize*(u-1)+(f-1))+')"/>'),i.push('<span class="m-t">'+r._getMaxText(l.title)+"</span>"),i.push('<span class="m-s">'+r._getMaxText(l.author)+"</span>"),i.push('<span class="m-z">'+r._getMaxText(l.album_title)+"</span>"),i.push('<span class="m-try" onclick="music.doselect('+(r.pageSize*(u-1)+(f-1))+');music.listenTest(this)"></span>'),i.push("</label>");i.push("</div>"),i.push("</div>")}return o.reverse(),s.push(o.join("")),i.push("</div>"),s.push("</div>"),i.join("")+s.join("")},exec:function(){var e=this;if(n==null)return;$G("J_preview").innerHTML="",editor.execCommand("music",{url:e._getUrl(!1),width:400,height:95})}}})();