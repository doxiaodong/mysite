define("func",[],function(){var e={$id:function(e){return document.getElementById(e)},$q:function(e){return document.querySelector(e)},$qa:function(e){return document.querySelectorAll(e)},extend:function(e,t){for(var n in e)n in t||(t[n]=e[n])},getFormData:function(e){var t=this,n={},r=t.$q(e),i=r.querySelectorAll("[name]"),s=i.length;for(var o=0;o<s;o++){var u=i[o];if(u.getAttribute("type")==="radio"||u.getAttribute("type")==="checkbox")if(!u.checked)continue;n[u.name]=u.value}var a=JSON.stringify(n);return r.classList.contains("xd-form-store")&&a!==window.localStorage.getItem("XD.form-"+r.id)&&window.XD.confirm("允许浏览器记住用户名和密码？",{title:"确认信息",ok:"确认",cancel:"取消"},function(){window.localStorage.setItem("XD.form-"+r.id,a)},function(){}),n},setFormData:function(){var e=this,t=e.$qa(".xd-form-store"),n=t.length;for(var r=0;r<n;r++){var i=window.localStorage.getItem("XD.form-"+t[r].id);if(i!==null){i=JSON.parse(i);var s=t[r].querySelectorAll("[name]");for(var o=0;o<s.length;o++){var u=s[o];u.getAttribute("type")!=="radio"&&u.getAttribute("type")!=="checkbox"&&(u.value=i[u.name])}}}},sign:function(e,t){var n=this.$id(e),r=this.$id(t);n.addEventListener("click",function(e){e.target.classList.contains("other-side")&&(this.classList.remove("active"),r.classList.add("active"))}),r.addEventListener("click",function(e){e.target.classList.contains("other-side")&&(this.classList.remove("active"),n.classList.add("active"))})},getCookie:function(e){var t=e.length,n=document.cookie.split("; "),r={};return n.forEach(function(n){if(e===n.slice(0,t)){r[e]=n.slice(t+1);return}}),r[e]},getSearch:function(e){var t=e.length,n=window.location.search.slice(1).split("&"),r={};return n.forEach(function(n){if(e===n.slice(0,t)){r[e]=n.slice(t+1);return}}),r[e]},ajaxSignin:function(){var e=this,t=e.$id("SIGNIN"),n=window.localStorage.getItem("XD.signin");n!==null,t.addEventListener("submit",function(n){var r=t.getAttribute("action"),i=e.getFormData("#SIGNIN"),s=JSON.stringify(i);window.XD.ajax({method:"POST",url:r,data:s,contentType:"application/json;charset=UTF-8",beforeSend:function(t){t.setRequestHeader("X-CSRFToken",e.getCookie("csrftoken"))},success:function(t,n,r){var t=JSON.parse(t);t.status===!0?e.afterSignin(t.data.user):window.XD.alert(t.data.error,{title:"登录出错",ok:"确认"})}}),n.preventDefault()})},afterSignin:function(e){var t=this.$id("USER"),n=this.$id("account_nav");n.getElementsByClassName("account")[0].classList.remove("hide"),n.getElementsByClassName("sign")[0].classList.add("hide"),t.innerHTML='<div class="header-side"><span class="xd-pjax nota" href="/account/">'+e+'</span><span class="signout a">退出</span></div>',window.XD.modules.Modal.close()},ajaxSignout:function(){var e=this,t=e.$id("USER");t.addEventListener("click",function(t){var n=t.target;if(n.classList.contains("signout")){var r=this.getAttribute("ajax-out");window.XD.ajax({method:"POST",url:r,beforeSend:function(t){t.setRequestHeader("X-CSRFToken",e.getCookie("csrftoken"))},complete:function(t,n,r){var t=JSON.parse(t);t.status===!0&&e.afterSignout()}})}})},afterSignout:function(){var e=this.$id("USER"),t=this.$id("account_nav");t.getElementsByClassName("account")[0].classList.add("hide"),t.getElementsByClassName("sign")[0].classList.remove("hide"),e.innerHTML='<div class="a header-side" xd-modal="#SIGN">登录</div>'},ajaxRegister:function(){var e=this,t=e.$id("REGISTER");t.addEventListener("submit",function(n){var r=t.getAttribute("action"),i=e.getFormData("#REGISTER"),s=JSON.stringify(i);window.XD.ajax({method:"POST",url:r,data:s,contentType:"application/json;charset=UTF-8",beforeSend:function(t){t.setRequestHeader("X-CSRFToken",e.getCookie("csrftoken"))},success:function(t,n,r){var t=JSON.parse(t);t.status===!0?e.afterSignin(t.data.user):window.XD.alert(t.data.error,{title:"提示",ok:"确认"})}}),n.preventDefault()})}};return e}),define("modules/xd.platform",["../func"],function(e){var t={init:function(){this.define()},define:function(){var e=window.navigator.userAgent.toLowerCase();window.XD.modules.platform={isiPad:e.match(/ipad/i)!==null,isiPhone:e.match(/iphone/i)!==null,isAndroid:e.match(/android/i)!==null,isBustedAndroid:e.match(/android 2\.[12]/)!==null,isAndroid23:e.match(/android 2\.3/i)!==null,isAndroid404:e.match(/android 4\.0\.4/i)!==null,isAndroid412:e.match(/android 4\.1\.2/i)!==null,isAndroid422:e.match(/android 4\.2\.2/i)!==null,isAndroid43:e.match(/android 4\.3/i)!==null,isAndroid4:e.match(/android 4/i)!==null,isAndroid5:e.match(/android 5/i)!==null,isNexus:e.match(/nexus/i)!==null,isDuos:e.match(/gt\-s7562/i)!==null,isS3:e.match(/gt\-i9300/i)!==null,isS4:e.match(/gt\-i9500/i)!==null,isNote3:e.match(/sm\-n900/i)!==null,isIE:/(msie|trident)/i.test(navigator.userAgent),isIE8:e.match(/msie 8/)!==null,isIE9:e.match(/msie 9/)!==null,isIE10:e.match(/msie 10/)!==null,isChrome:e.match(/Chrome/gi)!==null,isFirefox:e.match(/firefox/gi)!==null,isWebkit:e.match(/webkit/gi)!==null,isGecko:e.match(/gecko/gi)!==null,isOpera:e.match(/opera/gi)!==null,isMobile:navigator.userAgent.match(/Android|webOS|iPhone|iPod|BlackBerry|IEMobile/i)&&navigator.userAgent.match(/Mobile/i)!==null,hasTouch:"ontouchstart"in window,supportsSvg:!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect},window.XD.modules.platform.isAndroidPad=window.XD.modules.platform.isAndroid&&!window.XD.modules.platform.isMobile,window.XD.modules.platform.isTablet=window.XD.modules.platform.isiPad||window.XD.modules.platform.isAndroidPad,window.XD.modules.platform.isDesktop=!window.XD.modules.platform.isMobile&&!window.XD.modules.platform.isTablet,window.XD.modules.platform.isIOS=window.XD.modules.platform.isiPad||window.XD.modules.platform.isiPhone,window.XD.modules.platform.isIOS5=window.XD.modules.platform.isIOS&&e.match(/os 5/i)!==null,window.XD.modules.platform.isIOS6=window.XD.modules.platform.isIOS&&e.match(/os 6/i)!==null,window.XD.modules.platform.isIOS7=window.XD.modules.platform.isIOS&&e.match(/os 7/i)!==null,window.XD.modules.platform.isIOS8=window.XD.modules.platform.isIOS&&e.match(/os 8/i)!==null}};return t}),define("modules/xd.ajax",["../func"],function(e){var t={init:function(){window.XD.modules.Ajax=function(t){var n={method:"GET",data:"",url:"",async:!0,contentType:"application/x-www-form-urlencoded",beforeSend:function(){},complete:function(){},success:function(){},error:function(){window.XD.alert("请求出错，请重新尝试。")}};e.extend(n,t);var r=t.method.toUpperCase(),i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState==4&&t.complete(i.response,i.status,i),i.readyState==4&&i.status==200&&t.success(i.response,i.status,i),i.readyState==4&&i.status>=400&&t.error(i.response,i.status,i)},i.open(r,t.url,t.async),t.beforeSend&&t.beforeSend(i),i.setRequestHeader("Content-Type",t.contentType),i.send(t.data)},window.XD.ajax=window.XD.modules.Ajax}};return t}),define("modules/xd.alert",["../func"],function(e){var t={init:function(){window.XD.modules.Alert=function(t,n,r){var t=t||"",i="",s="OK";typeof n=="function"&&(r=arguments[1],n=undefined),n!==undefined&&(i=n.title||i,s=n.ok||s);var o='<div class="xd-alert shown"><div class="xd-container"><header class="xd-header">'+i+"</header>"+'<article class="xd-article">'+t+"</article>"+'<footer class="xd-footer">'+'<button class="btn xd-alert-close-button">'+s+"</button>"+"</footer>"+'<i class="xd-alert-close icon ion-ios-close-empty"></i>'+"</div>"+"</div>",u=document.createElement("div");u.classList.add("xd-alert-container"),u.innerHTML=o,e.$q("body").appendChild(u),u.addEventListener("click",function(t){if(t.target.classList.contains("xd-alert-close")||t.target.classList.contains("xd-alert-close-button"))e.$q("body").removeChild(u),r&&r()})},window.XD.alert=window.XD.modules.Alert}};return t}),define("modules/xd.confirm",["../func"],function(e){var t={init:function(){window.XD.modules.Confirm=function(t,n,r,i){var t=t||"",s="Confirm Message",o="OK",u="Cancel";typeof n=="function"&&(i=arguments[2],r=arguments[1],n=undefined),n!==undefined&&(s=n.title||s,o=n.ok||o,u=n.cancel||u);var a='<div class="xd-confirm shown"><div class="xd-container"><header class="xd-header">'+s+"</header>"+'<article class="xd-article">'+t+"</article>"+'<footer class="xd-footer">'+'<button class="btn xd-confirm-ok-button">'+o+"</button>"+'<button class="btn btn-side xd-confirm-cancel-button">'+u+"</button>"+"</footer>"+'<i class="xd-confirm-close icon ion-ios-close-empty"></i>'+"</div>"+"</div>",f=document.createElement("div");f.classList.add("xd-confirm-container"),f.innerHTML=a,e.$q("body").appendChild(f),f.addEventListener("click",function(t){var n=t.target.classList;n.contains("xd-confirm-ok-button")&&(e.$q("body").removeChild(f),r&&r());if(n.contains("xd-confirm-close")||t.target.classList.contains("xd-confirm-cancel-button"))e.$q("body").removeChild(f),i&&i()})},window.XD.confirm=window.XD.modules.Confirm}};return t}),define("modules/xd.indicator",["../func"],function(e){var t={init:function(){var t='<div class="preloader"></div>',n=document.createElement("div");n.classList.add("indicator"),n.innerHTML=t,e.$q("body").appendChild(n);var r,i;window.XD.hideIndicator=function(){r&&clearTimeout(r),i&&clearTimeout(i),n.classList.remove("active")},window.XD.showIndicator=function(){i=setTimeout(function(){n.classList.add("active")},500),r=setTimeout(function(){window.XD.hideIndicator(),window.XD.alert("加载超时，请重新尝试。")},1e4)}}};return t}),define("modules/xd.modal",["../func"],function(e){var t={init:function(){this.define(),document.addEventListener("click",function(e){var t=e.target.getAttribute("xd-modal");t!==null&&window.XD.modules.Modal.show(t)}),document.addEventListener("click",function(e){e.target.classList.contains("xd-modal-close")&&window.XD.modules.Modal.close()})},define:function(){var t;window.XD.modules.Modal={show:function(n){var r=this;e.$q(".xd-modal.shown")!==null&&r.close();var i=e.$q(n);i.classList.add("showing"),i.classList.add("shown"),t=setTimeout(function(){i.classList.remove("showing")},200)},close:function(){t!==undefined&&clearTimeout(t);var n=e.$q(".xd-modal.shown").classList;n.contains("showing")&&n.remove("showing"),n.remove("shown")}}}};return t}),define("pages/home/home",["../../func"],function(e){var t={init:function(){}};return t}),define("pages/article/detail",["../../func"],function(e){var t={init:function(){function e(e){e.show=function(){}}window.XD.modules.platform.isMobile||SyntaxHighlighter.highlight(),this.countReply(),this.replyArticle(),this.replyComment()},countReply:function(){if(angular)return;var t=e.$q(".count-replys"),n=t.getAttribute("ng-init").replace(/ /g,"").replace("count=","").split("+"),r=0;for(var i in n)r+=n[i]-0;t.innerHTML=r},replyArticle:function(){var n=e.$id("total_page"),r=n?n.getAttribute("page")-0:1,i=e.getSearch("page")-0,s=e.$qa(".root-reply").length===10,o=r===i&&s?r+1:r,u=window.location.href.replace(/page=\d/,"page="+o),a=e.$id("REPLY_ARTICLE");e.$id("ADD_REPLY_BUTTON").addEventListener("click",function(n){var r=a.getAttribute("action"),i=e.getFormData("#REPLY_ARTICLE"),s=JSON.stringify(i);window.XD.showIndicator(),window.XD.ajax({method:"POST",url:r,data:s,contentType:"application/json;charset=UTF-8",beforeSend:function(t){t.setRequestHeader("X-CSRFToken",e.getCookie("csrftoken"))},success:function(n,r,i){var n=JSON.parse(n);n.status===!0?(window.XD.showIndicator(),window.XD.ajax({url:u,contentType:"text/html;charset=utf-8",beforeSend:function(e){e.setRequestHeader("XD-PJAX","true")},success:function(n,r,i){e.$q("#PJAX_CONTAINER").innerHTML=n,t.init(),angular.bootstrap(e.$id("MAIN_APP"))},error:function(e,t,n){window.location.reload(),window.XD.alert("请求出错，请重新尝试。")},complete:function(){window.XD.hideIndicator()}})):n.data.not_login?window.XD.alert(n.data.error,{title:"出错啦",ok:"登录"},function(){window.XD.modules.Modal.show("#SIGN")}):window.XD.alert(n.data.error,{title:"出错啦",ok:"确认"})},complete:function(){window.XD.hideIndicator()}}),n.preventDefault()})},replyComment:function(){var n=e.$q(".replys");n.addEventListener("click",function(n){var r=n.target;if(r.getAttribute("reply-object")){var i=r.getAttribute("floor"),s=e.$q(".floor-"+i);if(!s.classList.contains("show")){var o=e.$qa(".reply-floor.show"),u=o.length;if(u!==0)for(var a=0;a<u;a++)o[a].classList.remove("show");s.classList.add("show");var f=s.querySelector(".reply-textarea");f.focus()}}if(r.classList.contains("add-subreply-button")){var i=r.getAttribute("floor"),l=e.$id("REPLY_COMMENT_"+i),c=l.getAttribute("action"),h=e.getFormData("#REPLY_COMMENT_"+i);e.extend({reply_object:l.getAttribute("reply-person")},h);var p=JSON.stringify(h);window.XD.showIndicator(),window.XD.ajax({method:"POST",url:c,data:p,contentType:"application/json;charset=UTF-8",beforeSend:function(t){t.setRequestHeader("X-CSRFToken",e.getCookie("csrftoken"))},success:function(n,r,i){var n=JSON.parse(n);n.status===!0?(window.XD.showIndicator(),window.XD.ajax({url:window.location.href,contentType:"text/html;charset=utf-8",beforeSend:function(e){e.setRequestHeader("XD-PJAX","true")},success:function(n,r,i){e.$q("#PJAX_CONTAINER").innerHTML=n,t.init(),angular.bootstrap(e.$id("MAIN_APP"))},error:function(e,t,n){window.location.reload(),window.XD.alert("请求出错，请重新尝试。")},complete:function(){window.XD.hideIndicator()}})):n.data.not_login?window.XD.alert(n.data.error,{title:"出错啦",ok:"登录"},function(){window.XD.modules.Modal.show("#SIGN")}):window.XD.alert(n.data.error,{title:"出错啦",ok:"确认"})},complete:function(){window.XD.hideIndicator()}}),n.preventDefault()}})}};return t}),define("pages/account/account",["../../func"],function(e){var t={init:function(){},reply:function(){var t=e.$id("replys");t.addEventListener("click",function(e){var t;for(var n in e.path){var r=e.path[n];if(r.classList.contains("each-reply")){t=r;break}}var i=t.getAttribute("data-href");window.location.href=i})}};return t}),define("pages/account/setting",["../../func"],function(e){var t={init:function(){this.changePic(),this.check(),FormData&&this.saveSetting()},check:function(){var t=e.$id("setting_sex_0"),n=e.$id("setting_sex_1");t.getAttribute("has-checked")==="true"&&t.setAttribute("checked","checked"),n.getAttribute("has-checked")==="true"&&n.setAttribute("checked","checked")},changePic:function(){var t=e.$id("setting_pic"),n=e.$id("change_pic");t&&t.addEventListener("change",function(){var e=this.files[0],t=window.URL.createObjectURL(e);n.setAttribute("src",t)})},saveSetting:function(){var t=e.$id("ACCOUNT_SETTING");if(!t)return;var n=document.forms.namedItem("SETTING"),r=t.querySelector('button[type="submit"]');t.addEventListener("submit",function(i){r.setAttribute("disabled","disabled"),r.innerHTML="保存中...";var s=new FormData(n),o=t.getAttribute("action"),u=new XMLHttpRequest;u.open("POST",o,!0),u.onreadystatechange=function(){var t=u.response;u.readyState==4&&(r.removeAttribute("disabled"),r.innerHTML="保存设置");if(u.readyState==4&&u.status==200){var t=JSON.parse(t);t.status===!0?(window.XD.alert("修改成功",{title:"提示",ok:"确认"}),e.$id("USER").innerHTML='<div class="header-side"><span>'+t.data.user+'</span><span class="signout a">退出</span></div>'):window.XD.alert(t.data.error,{title:"出错啦",ok:"确认"})}u.readyState==4&&u.status>=400},u.send(s),i.preventDefault()})}};return t}),define("pages/pageRouter",["func","pages/home/home","pages/article/detail","pages/account/account","pages/account/setting"],function(e,t,n,r,i){var s={init:function(){var s=window.location.pathname;s==="/"&&t.init(),s.match(/^\/article\/.+\/\d+\/$/)&&n.init(),s.match(/^\/account\/$/)&&r.init(),s.match(/^\/account\/setting\/$/)&&i.init(),angular.bootstrap(e.$id("MAIN_APP"))}};return s}),define("modules/xd.pjax",["../pages/pageRouter","../func"],function(e,t){var n={init:function(r,i,s){var o=t.$id("header_nav");window.history.replaceState({url:window.location.href,time:(new Date).getTime(),container:r,index:o.getAttribute("index")},"first",window.location.href);var u="click";window.XD.modules.platform.hasTouch&&!window.XD.modules.platform.isDesktop&&(u="touchstart");var a,f,l,c,h,p,d=!1;document.addEventListener(u,function(e){var t=this,o=e.target;while(o!==t){if(!o)break;if(o.classList&&o.classList.contains("xd-pjax"))break;o=o.parentNode}a=o,f=t;if(u==="touchstart"&&e.touches.length==1){var d=e.touches[0];l=d.pageX,c=d.pageX,h=d.pageY,p=d.pageY}u==="click"&&n.pjax(o,t,r,i,s),o&&o.classList&&o.classList.contains("xd-pjax")&&!o.classList.contains("nota")&&e.preventDefault()}),document.addEventListener("touchmove",function(e){if(e.touches.length==1){var t=e.touches[0];c=t.pageX,p=t.pageY,d=!0}}),document.addEventListener("touchend",function(e){if(d){d=!1;return}n.pjax(a,f,r,i,s)}),window.addEventListener("popstate",function(n){var r=n.state;if(r===null)return;if(n.title==="first"){window.location.reload();return}i&&window.XD.showIndicator(),window.XD.modules.Ajax({url:r.url,contentType:"text/html;charset=utf-8",beforeSend:function(e){e.setRequestHeader("XD-PJAX","true")},success:function(n,o,u){i&&window.XD.hideIndicator(),t.$q(r.container).innerHTML=n,s(r.index),e.init()},error:function(e,t,n){i&&(window.XD.hideIndicator(),window.XD.alert("请求出错或页面不存在。"))}})})},pjax:function(n,r,i,s,o){if(n&&n.classList&&n.classList.contains("xd-pjax")){var u=n.getAttribute("pjax-container")||i,a=n.getAttribute("href");s&&window.XD.showIndicator();if(n.getAttribute("comments"))var f=!0;window.XD.modules.Ajax({url:a,contentType:"text/html;charset=utf-8",beforeSend:function(e){e.setRequestHeader("XD-PJAX","true")},complete:function(){s&&window.XD.hideIndicator()},success:function(r,i,s){t.$q(u).innerHTML=r;var l=n.getAttribute("data-index");l||(a.split("/")[1]===""&&(l="0"),a.split("/")[1]==="article"&&(l="1"),a.split("/")[1]==="account"&&(l="2"),a.split("/")[1]==="about"&&(l="3")),o(l);var c=t.$id("header_nav").getAttribute("index");window.history.pushState({url:a,time:(new Date).getTime(),container:u,index:c},"",a),e.init(),f&&(document.body.scrollTop=t.$id("reply_comments").getBoundingClientRect().top-100)},error:function(e,t,n){window.XD.alert("请求出错或页面不存在。")}})}}};return n}),define("modules/module",["../func","modules/xd.platform","modules/xd.ajax","modules/xd.alert","modules/xd.confirm","modules/xd.indicator","modules/xd.modal","modules/xd.pjax"],function(e,t,n,r,i,s,o,u){var a={init:function(){n.init(),t.init(),r.init(),i.init(),s.init(),o.init(),u.init("#PJAX_CONTAINER","indicator",function(t){if(t){var n=e.$id("header_nav");n.setAttribute("index",t)}document.title=e.$id("MAIN_APP").getAttribute("title")+"--darlin.me"})}};return a}),function(){require.config({paths:{},shim:{}}),require(["modules/module","pages/pageRouter","func"],function(e,t,n){var r={init:function(){window.XD={modules:{},angular:{},tmp:{}},this.initModules(),this.initPlatform(),this.initLayout(),this.initPages()},initLayout:function(){angular.element(document).ready(function(){angular.bootstrap(n.$id("SIGN")),n.$q("body").classList.remove("loading"),n.$id("page_loading").remove(),console.log("初始化完成"),n.setFormData()});var e=n.$id("header_nav");e.addEventListener("click",function(e){e.target.hasAttribute("disabled")&&window.XD.alert("等等哟～")}),document.addEventListener("visibilitychange",function(){var e=document.visibilityState;e==="hidden"&&(document.title="点我啊，草泥马！！"),e==="visible"&&(document.title=n.$id("MAIN_APP").getAttribute("title")+"--darlin.me")}),n.sign("SIGNIN","REGISTER"),n.ajaxSignin(),n.ajaxSignout(),n.ajaxRegister()},initModules:function(){e.init(),SyntaxHighlighter&&!window.XD.modules.platform.isMobile&&SyntaxHighlighter.all()},initPages:function(){t.init()},initPlatform:function(){var e=n.$q("html").classList;window.XD.modules.platform.hasTouch&&e.add("touch"),window.XD.modules.platform.isAndroid&&e.add("android"),window.XD.modules.platform.isDesktop&&e.add("desktop"),window.XD.modules.platform.isIOS&&e.add("ios"),window.XD.modules.platform.isMobile&&e.add("mobile")}};r.init()})}(),define("main",function(){});