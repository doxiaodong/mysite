window.onload=function(){var e=function(){var e=document.getElementById("write_form"),t=document.getElementById("message"),n=document.getElementById("user_list"),r=e.getAttribute("host"),i=e.getAttribute("user"),s=document.getElementById("write_input"),o=window.location.protocol,u=o==="https:"?"wss":"ws",a=new WebSocket(u+r);i||(i=prompt("请输入你的昵称！")),e.addEventListener("submit",function(e){i||(i=prompt("请输入你的昵称！")),i||(i="大傻逼");var t=JSON.stringify({type:"add message",user:i,msg:s.value});a.send(t),s.value="",e.preventDefault()}),a.addEventListener("open",function(){console.log("open")}),a.addEventListener("message",function(e){var r=e.data;try{r=JSON.parse(r)}catch(e){}switch(r.type){case"add to ul":var i=function(){if(r.me==="me")return;var e=document.createElement("li");e.classList.add("each-message");var n='<span class="left username">'+r.user+":</span>"+'<span class="right content">'+r.msg+"</span>";e.innerHTML=n,t.appendChild(e)},s=function(){var e=document.getElementById(r.id);if(e){r.me==="me"&&e.classList.add("me");return}var t=document.createElement("li");t.classList.add("nowrap"),t.id=r.id,t.innerHTML=r.user,n.appendChild(t)};i(),s();break;case"remover person":var o=document.getElementById(r.id);o&&o.remove()}}),a.addEventListener("close",function(){console.log("close")})};e(),document.addEventListener("visibilitychange",function(){var e=document.visibilityState;e==="hidden"&&(document.title="点我啊，草泥马！！"),e==="visible"&&(document.title=document.getElementById("MAIN_APP").getAttribute("title")+"--darlin.me")})};