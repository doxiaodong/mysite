window.onload=function(){var e=0,t=document.getElementsByTagName("html")[0],n=function(){var n=null,r="id"+(new Date).getTime()+Math.random(),i=document.getElementById("write_form"),s=document.getElementById("message"),o=document.getElementById("user_list"),u=i.getAttribute("host"),a=i.getAttribute("user"),f=document.getElementById("write_input"),l,c=!0,h=window.location.protocol,p=h==="https:"?"wss":"ws";a||(a=prompt("请输入你的昵称！"));var d=function(){var n;n=p+u;var r=new WebSocket(n);return r.addEventListener("open",function(){console.log("open")}),r.addEventListener("message",function(n){var r=n.data;try{r=JSON.parse(r)}catch(n){}switch(r.type){case"add to ul":var i=function(){var n=document.createElement("li");n.classList.add("each-message");var i='<span class="left username">'+r.user+":</span>"+'<span class="right content">'+r.msg+"</span>";n.innerHTML=i,s.appendChild(n),e++,t.classList.contains("hidden")&&(document.title="你有"+e+"条新消息喔～～")},u=function(){var e=function(){var e=document.createElement("li");e.classList.add("nowrap"),e.id=r.new_id,e.setAttribute("data-id",r.id),e.innerHTML=r.user,o.appendChild(e)},t=document.getElementById(r.new_id);if(t){t.getAttribute("data-id")!==r.id&&t.setAttribute("data-id",r.id);return}r.me==="me"?c&&(e(),document.getElementById(r.new_id).classList.add("me"),c=!1):e()};i(),u();break;case"remover person":var a=document.querySelector('[data-id="'+r.id+'"]');a&&a.remove()}}),r.addEventListener("close",function(){console.log("close"),setTimeout(function(){l=d(),console.log("reopen")},1e3)}),r};l=d(),i.addEventListener("submit",function(e){a||(a=prompt("请输入你的昵称！")),a||(a="大傻逼");var t={type:"add message",user:a,msg:f.value};n=r,t.new_id=n,l.send(JSON.stringify(t)),f.value="",e.preventDefault()})};n(),document.addEventListener("visibilitychange",function(){var n=document.visibilityState;n==="hidden"&&(document.title="点我啊，草泥马！！",t.classList.contains("visible")&&t.classList.remove("visible"),t.classList.add("hidden"),e=0),n==="visible"&&(document.title=document.getElementById("MAIN_APP").getAttribute("title")+"--darlin.me",t.classList.contains("hidden")&&t.classList.remove("hidden"),t.classList.add("visible"))})};