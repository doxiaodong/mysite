window.onload=function(){var e=function(){var e=document.getElementById("write_form"),t=document.getElementById("message"),n=document.getElementById("user_list"),r=e.getAttribute("host"),i=e.getAttribute("user"),s=document.getElementById("write_input"),o=!0,u=window.location.protocol,a=u==="https:"?"wss":"ws",f=new WebSocket(a+r);i||(i=prompt("请输入你的昵称！")),e.addEventListener("submit",function(e){i||(i=prompt("请输入你的昵称！")),i||(i="大傻逼");var t=JSON.stringify({type:"add message",user:i,msg:s.value});f.send(t),s.value="",e.preventDefault()}),f.addEventListener("open",function(){console.log("open")}),f.addEventListener("message",function(e){var r=e.data;try{r=JSON.parse(r)}catch(e){}switch(r.type){case"add to ul":var i=function(){var e=document.createElement("li");e.classList.add("each-message");var n='<span class="left username">'+r.user+":</span>"+'<span class="right content">'+r.msg+"</span>";e.innerHTML=n,t.appendChild(e)},s=function(){var e=function(){var e=document.createElement("li");e.classList.add("nowrap"),e.id=r.id,e.innerHTML=r.user,n.appendChild(e)};if(document.getElementById(r.id))return;r.me==="me"?o&&(e(),document.getElementById(r.id).classList.add("me"),o=!1):e()};i(),s();break;case"remover person":var u=document.getElementById(r.id);u&&u.remove()}}),f.addEventListener("close",function(){console.log("close"),setTimeout(function(){f=new WebSocket(a+r)},1e3)})};e(),document.addEventListener("visibilitychange",function(){var e=document.visibilityState;e==="hidden"&&(document.title="点我啊，草泥马！！"),e==="visible"&&(document.title=document.getElementById("MAIN_APP").getAttribute("title")+"--darlin.me")})};