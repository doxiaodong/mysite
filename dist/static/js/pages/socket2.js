window.onload=function(){var e=0,t=document.getElementsByTagName("html")[0],n=function(){var n=document.getElementById("write_form"),r=document.getElementById("message"),i=document.getElementById("user_list"),s=n.getAttribute("host"),o=n.getAttribute("user"),u=document.getElementById("write_input"),a,f=!0,l=window.location.protocol,c=l==="https:"?"wss":"ws";o||(o=prompt("请输入你的昵称！"));var h=function(){var n=new WebSocket(c+s);return n.addEventListener("open",function(){console.log("open")}),n.addEventListener("message",function(n){var s=n.data;try{s=JSON.parse(s)}catch(n){}switch(s.type){case"add to ul":var o=function(){var n=document.createElement("li");n.classList.add("each-message");var i='<span class="left username">'+s.user+":</span>"+'<span class="right content">'+s.msg+"</span>";n.innerHTML=i,r.appendChild(n),e++,t.classList.contains("hidden")&&(document.title="你有"+e+"条新消息喔～～")},u=function(){var e=function(){var e=document.createElement("li");e.classList.add("nowrap"),e.id=s.id,e.innerHTML=s.user,i.appendChild(e)};if(document.getElementById(s.id))return;s.me==="me"?f&&(e(),document.getElementById(s.id).classList.add("me"),f=!1):e()};o(),u();break;case"remover person":var a=document.getElementById(s.id);a&&a.remove()}}),n.addEventListener("close",function(){console.log("close"),setTimeout(function(){a=h(),console.log("reopen")},1e3)}),n};a=h(),n.addEventListener("submit",function(e){o||(o=prompt("请输入你的昵称！")),o||(o="大傻逼");var t=JSON.stringify({type:"add message",user:o,msg:u.value});a.send(t),u.value="",e.preventDefault()})};n(),document.addEventListener("visibilitychange",function(){var n=document.visibilityState;n==="hidden"&&(document.title="点我啊，草泥马！！",t.classList.contains("visible")&&t.classList.remove("visible"),t.classList.add("hidden"),e=0),n==="visible"&&(document.title=document.getElementById("MAIN_APP").getAttribute("title")+"--darlin.me",t.classList.contains("hidden")&&t.classList.remove("hidden"),t.classList.add("visible"))})};