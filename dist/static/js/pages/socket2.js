window.addEventListener("load",function(){var e=0,t=document.getElementsByTagName("html")[0],n=function(){var n=document.getElementById("MAIN_APP").getAttribute("ip_md5"),r=null,i=n,s="#"+parseInt(i.replace(/^0+/,"").slice(0,6),36).toString(16).slice(0,6),o=document.getElementById("write_form"),u=document.getElementById("message"),a=document.getElementById("user_list"),f=o.getAttribute("host"),l=o.getAttribute("user"),c=document.getElementById("write_input"),h,p=window.location.protocol,d=p==="https:"?"wss":"ws";l||(l=prompt("请输入你的昵称！"));var v=function(){var n;n=d+f;var r=new WebSocket(n);return r.addEventListener("open",function(){console.log("open")}),r.addEventListener("message",function(n){var r=n.data;try{r=JSON.parse(r)}catch(n){}switch(r.type){case"add to ul":var i=function(){var n=document.createElement("li");n.classList.add("each-message");var i='<span style="color: '+r.color+'" class="left username nowrap" title="'+r.user+'">'+r.user+":</span>"+'<span class="right content">'+r.msg+"</span>";n.innerHTML=i,u.appendChild(n),e++,t.classList.contains("hidden")&&(document.title="你有"+e+"条新消息喔～～")},s=function(){var e=function(){var e=document.createElement("li");e.classList.add("nowrap"),e.id=r.new_id,e.style.color=r.color,e.setAttribute("data-id",r.id),e.setAttribute("title",r.user),e.innerHTML=r.user,a.appendChild(e)},t=document.getElementById(r.new_id);if(t){t.getAttribute("data-id")!==r.id&&t.setAttribute("data-id",r.id);return}e(),r.me==="me"&&document.getElementById(r.new_id).classList.add("me")};i(),s();break;case"remover person":var o=document.querySelector('[data-id="'+r.id+'"]');o&&o.remove()}}),r.addEventListener("close",function(){console.log("close"),setTimeout(function(){try{h=v(),console.log("reopen")}catch(e){}},1e3)}),r};h=v(),o.addEventListener("submit",function(e){l||(l=prompt("请输入你的昵称！")),l||(l="大傻逼");var t={type:"add message",user:l,color:s,msg:c.value};r="id"+i+l,t.new_id=r,h.send(JSON.stringify(t)),c.value="",e.preventDefault()})};n(),document.addEventListener("visibilitychange",function(){var n=document.visibilityState;n==="hidden"&&(document.title="点我啊，草泥马！！",t.classList.contains("visible")&&t.classList.remove("visible"),t.classList.add("hidden"),e=0),n==="visible"&&(document.title=document.getElementById("MAIN_APP").getAttribute("title")+"--darlin.me",t.classList.contains("hidden")&&t.classList.remove("hidden"),t.classList.add("visible"))});var r=navigator.userAgent,i={isMobile:r.match(/Android|webOS|iPhone|iPod|BlackBerry|IEMobile/i)&&r.match(/Mobile/i)!==null,isSafari:r.indexOf("Safari")>-1&&r.indexOf("Chrome")==-1};if(!i.isMobile&&!i.isSafari){(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})();var s=function(){function a(e){o.x=e.pageX,o.y=e.pageY}function f(){r=window.innerWidth,i=window.innerHeight,t.width=r,t.height=i}function l(){var e={};return e.speed={x:-5+Math.random()*10,y:-15+Math.random()*10},o.x&&o.y?e.location={x:o.x,y:o.y}:e.location={x:r/2,y:i-50},e.radius=10+Math.random()*20,e.life=20+Math.random()*10,e.remaining_life=e.life,e.r=Math.floor(Math.random()*256),e.g=Math.floor(Math.random()*256),e.b=Math.floor(Math.random()*256),e}function c(e){n.globalCompositeOperation="source-over",n.fillStyle="black",n.fillRect(0,0,r,i),n.globalCompositeOperation="lighter";for(var t=0;t<e;t++){var o=s[t];n.beginPath(),o.opacity=Math.round(o.remaining_life/o.life*100)/100;var u=n.createRadialGradient(o.location.x,o.location.y,0,o.location.x,o.location.y,o.radius);u.addColorStop(0,"rgba("+o.r+", "+o.g+", "+o.b+", "+o.opacity+")"),u.addColorStop(.5,"rgba("+o.r+", "+o.g+", "+o.b+", "+o.opacity+")"),u.addColorStop(1,"rgba("+o.r+", "+o.g+", "+o.b+", 0)"),n.fillStyle=u,n.arc(o.location.x,o.location.y,o.radius,Math.PI*2,!1),n.fill(),o.remaining_life--,o.radius++,o.location.x+=o.speed.x,o.location.y+=o.speed.y;if(o.remaining_life<=0||o.radius>=50)s[t]=l()}}var e=document.createElement("canvas");e.id="myCanvas",document.getElementsByTagName("body")[0].appendChild(e);var t=document.getElementById("myCanvas"),n=t.getContext("2d"),r,i,s=[],o={},u=function(){f();var e=50;for(var t=0;t<e;t++)s.push(l());var n=s.length;window.addEventListener("mousemove",a,!1),window.addEventListener("resize",f);var r=function(){c(n),window.requestAnimationFrame(r)};r()};return{init:u}}();s.init()}});