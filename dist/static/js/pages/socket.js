window.onload=function(){var e=window.location.protocol,t=document.getElementById("write_form"),n=document.getElementById("message"),r=document.getElementById("user_list"),i=t.getAttribute("host"),s=t.getAttribute("user"),o=io.connect(e+i),u=document.getElementById("write_input");s||(s=prompt("请输入你的昵称！")),t.addEventListener("submit",function(e){s||(s=prompt("请输入你的昵称！")),s||(s="大傻逼"),o.emit("send message",{user:s,id:o.id,msg:u.value}),u.value="",e.preventDefault()}),o.on("add to ul",function(e){var t=document.createElement("li");t.classList.add("each-message");var r='<span class="left username">'+e.user+":</span>"+'<span class="right content">'+e.msg+"</span>";t.innerHTML=r,n.appendChild(t)}),o.on("add person",function(e){if(document.getElementById(e.id))return;var t=document.createElement("li");t.classList.add("nowrap"),t.id=e.id,t.innerHTML=e.user,r.appendChild(t)}),o.on("remove person",function(e){var t=document.getElementById(e);t&&t.remove()}),document.addEventListener("visibilitychange",function(){var e=document.visibilityState;e==="hidden"&&(document.title="点我啊，草泥马！！"),e==="visible"&&(document.title=document.getElementById("MAIN_APP").getAttribute("title")+"--darlin.me")})};